## Extracting clinical data
## Nelly Blindenbacher
## July 2023

# Load packages into R
library(readxl)
library(dplyr)
library(writexl)
library(kableExtra)

# Load data
clinicaldata_competition <- read_xlsx("Data_matched_incl_anonymization.xlsx") %>%
  select(IAT, sex, age, IVT, INR, serum_creatinin, systolic_blood_pressure, diastolic_blood_pressure, previous_stroke, diabetes_mellitus, hypertension, atrial_fibrillation, prestroke_mrs, symptom_onset_to_door, NIHSS_baseline, occlusion_site, collateral_score, anonym_ID)

# Define the local directory path
local_directory <- "\\\\fs-home/bline$/Documents/Projekte/9 CT Model vs. Neurologist/2 R Versions/3 Week 27"

# Define the main folder name
main_folder_name <- "Competition_Data"

# Create the main folder within the local directory if it doesn't exist
main_folder <- file.path(local_directory, main_folder_name)
if (!file.exists(main_folder)) {
  dir.create(main_folder)
}

# Save structured data for each patient in the respective subfolder (Part 1 or Part 2)
for (x in 1:40) {
  # Get the anonym_ID for the current iteration
  anonym_ID <- clinicaldata_competition$anonym_ID[x]
  
  # Create the kable table
  kable_table <- kable(clinicaldata_competition[x,], format = "html", escape = FALSE) %>%
    kable_styling(bootstrap_options = "striped", full_width = FALSE)
  
  # Specify the subfolder paths for Part 1 and Part 2
  subfolder_part1 <- file.path(main_folder, "Part 1", anonym_ID)
  subfolder_part2 <- file.path(main_folder, "Part 2", anonym_ID)
  
  # Create the subfolders if they don't exist
  if (!file.exists(subfolder_part1)) {
    dir.create(subfolder_part1, recursive = TRUE)
  }
  
  if (!file.exists(subfolder_part2)) {
    dir.create(subfolder_part2, recursive = TRUE)
  }
  
  # Save the kable table as an HTML file in the corresponding subfolder (Part 1 or Part 2)
  html_file_part1 <- file.path(subfolder_part1, paste0("Clinicaldata_", anonym_ID, ".html"))
  html_file_part2 <- file.path(subfolder_part2, paste0("Clinicaldata_", anonym_ID, ".html"))
  
  writeLines(as.character(kable_table), html_file_part1)
  writeLines(as.character(kable_table), html_file_part2)
}
